<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot AI</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        display: flex;
        flex-direction: column;
        height: 100vh;
        position: relative;
      }
      .online-status {
        position: absolute;
        top: 40px;
        left: 0;
        width: 100%;
        background-color: #f5f5f5;
        color: #a767e5;
        text-align: center;
        padding: 5px 0;
        font-size: 12px;
        z-index: 6;
      }
      .copilot-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background-color: white;
        color: #a767e5;
        text-align: center;
        padding: 7px 0;
        font-size: 18px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        z-index: 2.5;
      }
      .chat-container {
        width: 90%;
        max-width: 680px;
        padding: 15px;
        background: linear-gradient(135deg, #f59de8, #a767e5);
        border-radius: 3px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        flex-grow: 1;
        overflow-y: auto;
        color: white;
        margin-top: 60px;
      }
      .message {
        margin: 10px 0;
        padding: 10px;
        border-radius: 20px;
        max-width: 40%;
        word-wrap: break-word;
        background-color: rgba(255, 255, 255, 0.3);
        position: relative;
      }
      .message.user {
        margin-left: auto;
        text-align: right;
      }
      .message.bot {
        margin-right: auto;
      }
      .read-status {
        position: absolute;
        bottom: -15px;
        right: 0;
        color: white;
        font-size: 14px;
      }
      .input-container {
        width: 100%;
        max-width: 600px;
        margin-top: 10px;
        display: flex;
        justify-content: center;
      }
      .input-container input {
        padding: 10px;
        flex-grow: 1;
        border: none;
        border-radius: 7px 0 0 7px;
        font-size: 14px;
      }
      .input-container button {
        padding: 10px;
        border: none;
        background-color: #a767e5;
        color: white;
        border-radius: 0 7px 7px 0;
        font-size: 14px;
        cursor: pointer;
      }
      .thinking {
        background-color: rgba(255, 255, 255, 0.3);
        font-style: italic;
        color: #6c757d;
        margin-right: auto;
      }
    </style>
</head>
<body>
<div class="copilot-header">Mbilse Copilot AI</div>
<div class="online-status">Online</div>
<div class="chat-container" id="chat"></div>

<div class="input-container">
  <input type="text" id="userInput" placeholder="输入你的消息..." onkeypress="handleKeyPress(event)">
  <button id="sendButton">Send</button>
</div>

<script>
// 初始化消息
window.onload = function() {
    const initMessage = createMessage(
        ' Hello,I am Mbilse Copilot AI-3.0.25，我可以帮你写作，解说，我还可以与你一起聊天', 
        'bot',
        true
    );
    document.getElementById("chat").appendChild(initMessage);
    scrollToBottom();
};

function handleKeyPress(event) {
    if (event.key === 'Enter') submitInput();
}

document.getElementById("sendButton").onclick = submitInput;

function submitInput() {
    const userInput = document.getElementById("userInput").value.trim();
    if (!userInput) return;

    // 显示用户消息（立即添加已送达）
    const chatDiv = document.getElementById("chat");
    const userMessage = createMessage(userInput, 'user');
    chatDiv.appendChild(userMessage);
    addDeliveryStatus(userMessage);
    scrollToBottom();

    // 显示正在思考
    const thinkingMessage = createMessage('Thinking...', 'bot');
    thinkingMessage.classList.add('thinking');
    chatDiv.appendChild(thinkingMessage);
    scrollToBottom();

    fetch(`https://api.52vmy.cn/api/chat/spark?msg=${encodeURIComponent(userInput)}`)
        .then(response => response.json())
        .then(data => {
            chatDiv.removeChild(thinkingMessage);
            const aiResponse = data.data?.answer || "抱歉，由于api请求限制，我们无法成功服务您，请稍后再试。";
            typeMessage(aiResponse, 'bot');
        })
        .catch(error => {
            console.error('Error:', error);
            chatDiv.removeChild(thinkingMessage);
            typeMessage('出现错误，请稍后再试。', 'bot');
        });

    document.getElementById("userInput").value = "";
}

function createMessage(text, type, immediate = false) {
    const div = document.createElement('div');
    div.className = `message ${type}`;
    div.textContent = `${type === 'user' ? '' : ''}${text}`;
    
    // 初始化消息直接添加已读状态
    if (immediate && type === 'bot') {
        addReadStatus(div);
    }
    return div;
}

function typeMessage(text, type) {
    const chatDiv = document.getElementById("chat");
    const messageDiv = createMessage('', type);
    chatDiv.appendChild(messageDiv);
    
    let index = 0;
    const typing = setInterval(() => {
        if (index < text.length) {
            messageDiv.textContent = `${text.substring(0, index + 1)}`;
            scrollToBottom();
            index++;
        } else {
            clearInterval(typing);
            addReadStatus(messageDiv); // 添加已读状态
        }
    }, 10); //改变响应时间为10ms
}

// 添加已送达状态
function addDeliveryStatus(messageElement) {
    const status = document.createElement('div');
    status.className = 'read-status';
    status.textContent = '已送达';
    messageElement.appendChild(status);
}

// 添加已读状态
function addReadStatus(messageElement) {
    const status = document.createElement('div');
    status.className = 'read-status';
    status.textContent = '已读';
    messageElement.appendChild(status);
    scrollToBottom();
}

function scrollToBottom() {
    const chat = document.getElementById("chat");
    chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
